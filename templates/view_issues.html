<!DOCTYPE html>
<html>
<head>
    <title>View Issues</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="navbar">
    <strong>IT Enterprise Support</strong>
    <a href="/dashboard">Dashboard</a>
    <a href="/log_issue">Log Issue</a>
    <a href="/export_excel">Export Excel</a>
    <a href="/logout">Logout</a>
</div>

<div class="container">

<h2>All Issues</h2>

<!-- ðŸ”Ž SEARCH -->
<form method="GET">
    <input type="text" name="search" placeholder="Search issues...">
    <button type="submit">Search</button>
</form>

<br>

<!-- ðŸ“… FILTER BUTTONS -->
<div>
    <a href="/view_issues?filter=today">Today</a> |
    <a href="/view_issues?filter=week">This Week</a> |
    <a href="/view_issues?filter=month">This Month</a> |
    <a href="/view_issues?filter=open">Open Only</a> |
    <a href="/view_issues">Overall</a>
</div>

<br>

<!-- ðŸ“Š PROGRESS BAR -->
<div style="background:#eee;width:100%;display:flex;height:25px;">
    <div style="background:red;width:{{open_percent}}%;color:white;text-align:center;">
        Open {{open_percent}}%
    </div>
    <div style="background:green;width:{{closed_percent}}%;color:white;text-align:center;">
        Closed {{closed_percent}}%
    </div>
</div>

<br>

<table border="1" width="100%">
<tr>
    <th>ID</th>
    <th>Title</th>
    <th>Status</th>
    <th>Assigned To</th>
    <th>Date Reported</th>
    <th>SLA (hrs)</th>
    <th>Action</th>
</tr>

{% for issue in issues %}
<tr>
    <td>{{ issue.id }}</td>
    <td>{{ issue.title }}</td>
    <td>{{ issue.status }}</td>

    <td>
        {% if session['role'] == 'Admin' %}
        <form method="POST" action="{{ url_for('assign_issue', issue_id=issue.id) }}">
            <select name="technician">
                {% for tech in technicians %}
                    <option value="{{ tech.username }}"
                        {% if tech.username == issue.assigned_to %}selected{% endif %}>
                        {{ tech.username }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit">Assign</button>
        </form>
        {% else %}
            {{ issue.assigned_to or "Unassigned" }}
        {% endif %}
    </td>

    <td>{{ issue.date_reported }}</td>
    <td>{{ issue.sla_hours }}</td>

    <td>
        {% if issue.status == "Open" %}
        <form method="POST" action="{{ url_for('close_issue', issue_id=issue.id) }}">
            <button type="submit">Close</button>
        </form>
        {% else %}
        <form method="POST" action="{{ url_for('reopen_issue', issue_id=issue.id) }}">
            <button type="submit">Reopen</button>
        </form>
        {% endif %}
    </td>
</tr>
{% endfor %}
</table>

</div>
</body>
</html>